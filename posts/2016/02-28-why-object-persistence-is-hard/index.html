<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Why object persistence is hard? - Nghia Bui</title><meta name=Description content="Welcome to my world - I talk to the wind"><meta property="og:url" content="/posts/2016/02-28-why-object-persistence-is-hard/">
<meta property="og:site_name" content="Nghia Bui"><meta property="og:title" content="Why object persistence is hard?"><meta property="og:description" content="Object persistence – for example, saving/loading objects to/from a database – is easy, especially when using an ORM framework. It is easy because it breaks principles of OO design.
When objects are used as data structures it is a design smell; and it always has been. When tools like Hibernate call themselves object-relational mappers, they are incorrect. ORMs don’t map relational data to objects; they map relational data to data structures. Those data structures are not objects.
— Uncle Bob in OO vs FP"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-02-28T00:00:00+00:00"><meta property="article:modified_time" content="2016-02-28T00:00:00+00:00"><meta property="article:tag" content="OOP"><meta property="article:tag" content="DesignPattern"><meta property="article:tag" content="Database"><meta property="og:image" content="/posts/2016/02-28-why-object-persistence-is-hard/featured.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/posts/2016/02-28-why-object-persistence-is-hard/featured.jpg"><meta name=twitter:title content="Why object persistence is hard?"><meta name=twitter:description content="Object persistence – for example, saving/loading objects to/from a database – is easy, especially when using an ORM framework. It is easy because it breaks principles of OO design.
When objects are used as data structures it is a design smell; and it always has been. When tools like Hibernate call themselves object-relational mappers, they are incorrect. ORMs don’t map relational data to objects; they map relational data to data structures. Those data structures are not objects.
— Uncle Bob in OO vs FP"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=/posts/2016/02-28-why-object-persistence-is-hard/><link rel=prev href=/posts/2016/01-26-oop-vs-ecs/><link rel=next href=/posts/2016/03-14-gof-builder-pattern/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Why object persistence is hard?","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"\/posts\/2016\/02-28-why-object-persistence-is-hard\/"},"image":[{"@type":"ImageObject","url":"\/posts\/2016\/02-28-why-object-persistence-is-hard\/featured.jpg","width":1383,"height":643}],"genre":"posts","keywords":"OOP, DesignPattern, Database","wordcount":617,"url":"\/posts\/2016\/02-28-why-object-persistence-is-hard\/","datePublished":"2016-02-28T00:00:00+00:00","dateModified":"2016-02-28T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Nghia"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Nghia Bui">Nghia Bui</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts>Posts </a><a class=menu-item href=/categories>Categories </a><a class=menu-item href=/tags>Tags </a><a class=menu-item href=https://github.com/katatunix/katatunix.github.io rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Nghia Bui">Nghia Bui</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts title>Posts</a><a class=menu-item href=/categories title>Categories</a><a class=menu-item href=/tags title>Tags</a><a class=menu-item href=https://github.com/katatunix/katatunix.github.io title rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Why object persistence is hard?</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Nghia</a></span>&nbsp;<span class=post-category>included in <a href=/categories/programming/><i class="far fa-folder fa-fw" aria-hidden=true></i>Programming</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime="February 28, 2016">February 28, 2016</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;617 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/2016/02-28-why-object-persistence-is-hard/featured.jpg data-srcset="/posts/2016/02-28-why-object-persistence-is-hard/featured.jpg, /posts/2016/02-28-why-object-persistence-is-hard/featured.jpg 1.5x, /posts/2016/02-28-why-object-persistence-is-hard/featured.jpg 2x" data-sizes=auto alt=/posts/2016/02-28-why-object-persistence-is-hard/featured.jpg title=/posts/2016/02-28-why-object-persistence-is-hard/featured.jpg></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#table-data-gateway-aka-data-access-objects--dao>Table Data Gateway (aka Data Access Objects — DAO)</a></li><li><a href=#proxy>Proxy</a></li><li><a href=#database-speaking-object>Database-speaking Object</a></li><li><a href=#what-should-we-choose>What should we choose?</a></li></ul></nav></div></div><div class=content id=content><p>Object persistence &ndash; for example, saving/loading objects to/from a database &ndash; is easy, especially when using an ORM framework. It is easy because it breaks principles of OO design.</p><blockquote><p>When objects are used as data structures it is a design smell; and it always has been. When tools like Hibernate call themselves object-relational mappers, they are incorrect. ORMs don&rsquo;t map relational data to objects; they map relational data to data structures. Those data structures are not objects.<br>&mdash; Uncle Bob in <a href=http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html target=_blank rel="noopener noreffer">OO vs FP</a></p></blockquote><p>Frankly, object persistence is hard because we need to pursuit both of the two principles:</p><ol><li>Encapsulation: objects must not expose their internal states.</li><li>Separation of concerns: objects must not be aware (directly/indirectly) about the persistence mechanism.</li></ol><p>Now we will discuss some typical patterns when dealing with object persistence, and see how they can satisfy only one of the two principles above.</p><h2 id=table-data-gateway-aka-data-access-objects--dao>Table Data Gateway (aka Data Access Objects — DAO)</h2><p>This pattern is simple and can be described in the diagram below:</p><p><figure><a class=lightgallery href=/posts/2016/02-28-why-object-persistence-is-hard/gateway.png title="Table Data Gateway" data-thumbnail=/posts/2016/02-28-why-object-persistence-is-hard/gateway.png data-sub-html="<h2>Table Data Gateway</h2><p>Table Data Gateway</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/2016/02-28-why-object-persistence-is-hard/gateway.png data-srcset="/posts/2016/02-28-why-object-persistence-is-hard/gateway.png, /posts/2016/02-28-why-object-persistence-is-hard/gateway.png 1.5x, /posts/2016/02-28-why-object-persistence-is-hard/gateway.png 2x" data-sizes=auto alt=/posts/2016/02-28-why-object-persistence-is-hard/gateway.png width=513 height=307></a><figcaption class=image-caption>Table Data Gateway</figcaption></figure></p><p>Clearly, Table Data Gateway breaks the principle #1. The method <code>Insert</code> needs to access the internal state of the object <code>Order</code> so it can write the state to database. This makes a bunch of getter methods for <code>Order</code>. Moreover, the method <code>Find</code> has to know how to construct an <code>Order</code> object from the loaded data. This also makes a bunch of setter methods and/or unnecessary complex constructors for the class <code>Order</code>.</p><p>Another problem <code>(*)</code> of this pattern is that sometimes we don&rsquo;t know how much of data should be loaded for an object <code>Order</code>. So we usually load all. What if the object has a relationship with other objects? For example, the object <code>Order</code> may keep a list of products that belong to this order. Should we load these products too? What if these products also have their own relationships? And so on.</p><h2 id=proxy>Proxy</h2><p><figure><a class=lightgallery href=/posts/2016/02-28-why-object-persistence-is-hard/proxy.png title=Proxy data-thumbnail=/posts/2016/02-28-why-object-persistence-is-hard/proxy.png data-sub-html="<h2>Proxy</h2><p>Proxy</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/2016/02-28-why-object-persistence-is-hard/proxy.png data-srcset="/posts/2016/02-28-why-object-persistence-is-hard/proxy.png, /posts/2016/02-28-why-object-persistence-is-hard/proxy.png 1.5x, /posts/2016/02-28-why-object-persistence-is-hard/proxy.png 2x" data-sizes=auto alt=/posts/2016/02-28-why-object-persistence-is-hard/proxy.png width=429 height=226></a><figcaption class=image-caption>Proxy</figcaption></figure></p><p>This pattern still breaks the principle #1 as the <code>ProductDBProxy</code> needs to construct/save the <code>ProductImplementation</code> through constructors and setter/getter methods.</p><p>However, the problem <code>(*)</code> can be solved. Though a proxy is basically a gateway, but unlike the gateway, which doesn&rsquo;t know how much data should be loaded, the proxy does, simply because in the context of one of its methods, the proxy knows which data are needed.</p><h2 id=database-speaking-object>Database-speaking Object</h2><p><figure><a class=lightgallery href=/posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg title="Database-speaking Object" data-thumbnail=/posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg data-sub-html="<h2>Database-speaking Object</h2><p>Database-speaking Object</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg data-srcset="/posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg, /posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg 1.5x, /posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg 2x" data-sizes=auto alt=/posts/2016/02-28-why-object-persistence-is-hard/db-speaking.jpg width=393 height=130></a><figcaption class=image-caption>Database-speaking Object</figcaption></figure></p><p>The pattern accepts breaking the principle #2. Each object holds a reference to a facade to the database and delegate all persistence stuff to this facade. The pattern solves the problem <code>(*)</code> nicely since each object by itself can actively load/save its data. I consider Memento pattern is similar to this pattern.</p><h2 id=what-should-we-choose>What should we choose?</h2><p>I always prefer the Table Data Gateway pattern because of its simplicity. Sometimes exposing internal states is not too bad. As we know, exposing internal states is evil because those states are implementation details, thus they are unstable and do cause annoyance to their clients. However, in this case, there is only one client consuming the extra getter/setter/constructor methods &ndash; the gateway. Hence the annoyance is mitigated.</p><p>To cope with the problem <code>(*)</code>, the gateway may create multiple versions of the objects with various level of filled data, depending on the (fixed) demands of its clients. But when those demands are not known, the Proxy pattern can be applied. Care should be taken as this pattern is very complex.</p><p>One simpler way to solve problem <code>(*)</code> is using the Database-speaking Object pattern, with the cost of breaking the principle #2. So you have to sustain the indirect dependency of your objects upon persistence-related APIs. In the future, it will be difficult to reuse your objects in another context which doesn&rsquo;t care about persistence. But will you?</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on February 28, 2016</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=/posts/2016/02-28-why-object-persistence-is-hard/ data-hashtag=OOP><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=/posts/2016/02-28-why-object-persistence-is-hard/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=%2fposts%2f2016%2f02-28-why-object-persistence-is-hard%2f&amp;text=Why%20object%20persistence%20is%20hard%3f" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/oop/>OOP</a>,&nbsp;<a href=/tags/designpattern/>DesignPattern</a>,&nbsp;<a href=/tags/database/>Database</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2016/01-26-oop-vs-ecs/ class=prev rel=prev title="OOP vs. ECS"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>OOP vs. ECS</a>
<a href=/posts/2016/03-14-gof-builder-pattern/ class=next rel=next title="GoF Builder Pattern">GoF Builder Pattern<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Nghia</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script src=https://katatunix.disqus.com/embed.js defer></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/copy-tex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/mhchem.min.js></script><script>window.config={comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script src=/js/theme.min.js></script></body></html>